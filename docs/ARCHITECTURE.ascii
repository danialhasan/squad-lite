╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    SQUAD LITE — SYSTEM ARCHITECTURE                                   ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝


┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           AGENT LAYER                                                 │
│                                                                                                       │
│    ┌─────────────────────────────────────┐                                                           │
│    │         S8: DIRECTOR AGENT          │                                                           │
│    │    ┌─────────────────────────────┐  │                                                           │
│    │    │  • Receives task from human │  │                                                           │
│    │    │  • Decomposes into subtasks │  │                                                           │
│    │    │  • Spawns Specialists       │  │                                                           │
│    │    │  • Aggregates results       │  │                                                           │
│    │    └─────────────────────────────┘  │                                                           │
│    └──────────────────┬──────────────────┘                                                           │
│                       │                                                                               │
│                       │ spawns & coordinates                                                          │
│                       │                                                                               │
│         ┌─────────────┼─────────────┬─────────────────────┐                                          │
│         │             │             │                     │                                          │
│         ▼             ▼             ▼                     ▼                                          │
│    ┌─────────┐   ┌─────────┐   ┌─────────┐          ┌─────────┐                                      │
│    │S9: SPEC │   │S9: SPEC │   │S9: SPEC │   ...    │S9: SPEC │                                      │
│    │Researcher│   │ Writer  │   │ Analyst │          │ Agent N │                                      │
│    └────┬────┘   └────┬────┘   └────┬────┘          └────┬────┘                                      │
│         │             │             │                    │                                            │
└─────────┼─────────────┼─────────────┼────────────────────┼────────────────────────────────────────────┘
          │             │             │                    │
          └─────────────┴──────┬──────┴────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        COORDINATION LAYER                                             │
│                                                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                              S7: CONTEXT MANAGEMENT SYSTEM                                      │  │
│  │                                                                                                 │  │
│  │   ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐                         │  │
│  │   │  S7a: SESSION    │    │ S7b: NOTIFICATION │    │  S7c: CONTEXT   │                         │  │
│  │   │    TRACKING      │    │    INJECTION      │    │   ASSEMBLY      │                         │  │
│  │   │                  │    │                   │    │                 │                         │  │
│  │   │ • SDK session ID │    │ • Mail → Notify  │    │ • Checkpoint    │                         │  │
│  │   │ • Resume support │    │ • Lightweight    │    │ • Notifications │                         │  │
│  │   │ • Token tracking │    │ • Tool to read   │    │ • Task state    │                         │  │
│  │   └──────────────────┘    └──────────────────┘    └──────────────────┘                         │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                       │
│  ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐                        │
│  │  S4: MESSAGE BUS     │  │  S5: CHECKPOINTS     │  │  S6: TASK MGMT       │                        │
│  │     (Agent Mail)     │  │                      │  │                      │                        │
│  │                      │  │                      │  │                      │                        │
│  │  • sendMessage()     │  │  • createCheckpoint()│  │  • createTask()      │                        │
│  │  • getInbox()        │  │  • getLatest()       │  │  • assignTask()      │                        │
│  │  • pollInbox()       │  │  • resumeFrom()      │  │  • updateStatus()    │                        │
│  │  • markAsRead()      │  │                      │  │  • completeTask()    │                        │
│  └──────────┬───────────┘  └──────────┬───────────┘  └──────────┬───────────┘                        │
│             │                         │                         │                                     │
└─────────────┼─────────────────────────┼─────────────────────────┼─────────────────────────────────────┘
              │                         │                         │
              └─────────────────────────┼─────────────────────────┘
                                        │
                                        ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           DATA LAYER                                                  │
│                                                                                                       │
│  ┌──────────────────────┐    S2: ZOD SCHEMAS (Type Safety)                                           │
│  │  S1: MONGODB CONN    │    ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                      │    │  AgentSchema │ MessageSchema │ CheckpointSchema │ TaskSchema        │ │
│  │  • Connection pool   │    └─────────────────────────────────────────────────────────────────────┘ │
│  │  • Index management  │                                                                            │
│  │  • Collection access │    S3: AGENT REGISTRY                                                      │
│  └──────────┬───────────┘    ┌─────────────────────────────────────────────────────────────────────┐ │
│             │                │  registerAgent() │ updateStatus() │ heartbeat() │ getActive()       │ │
│             │                └─────────────────────────────────────────────────────────────────────┘ │
│             │                                                                                        │
│             ▼                                                                                        │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                    MONGODB ATLAS                                              │   │
│  │                                                                                               │   │
│  │   ┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐                       │   │
│  │   │   agents   │    │  messages  │    │checkpoints │    │   tasks    │                       │   │
│  │   │            │    │            │    │            │    │            │                       │   │
│  │   │ agentId    │    │ messageId  │    │checkpointId│    │ taskId     │                       │   │
│  │   │ type       │    │ fromAgent  │    │ agentId    │    │ assignedTo │                       │   │
│  │   │ status     │    │ toAgent    │    │ summary    │    │ status     │                       │   │
│  │   │ sessionId  │    │ content    │    │ resumePtr  │    │ result     │                       │   │
│  │   │ parentId   │    │ type       │    │ tokensUsed │    │ parentTask │                       │   │
│  │   └────────────┘    └────────────┘    └────────────┘    └────────────┘                       │   │
│  │                                                                                               │   │
│  └───────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                       │
└───────────────────────────────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                      DEPENDENCY GRAPH (BUILD ORDER)                                   ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

 TIER 0 (✅ DONE)              TIER 1 (BUILD FIRST)           TIER 2 (BUILD SECOND)       TIER 3 (POLISH)
 ════════════════              ════════════════════           ═════════════════════       ═══════════════

 ┌─────────────────┐
 │ S1: MongoDB     │
 │ Connection      │───────┐
 └─────────────────┘       │
                           │
 ┌─────────────────┐       │      ┌─────────────────┐
 │ S2: Zod         │───────┼─────▶│ S6: Task        │
 │ Schemas         │       │      │ Management      │───────┐
 └─────────────────┘       │      └─────────────────┘       │
                           │                                │
 ┌─────────────────┐       │                                │      ┌─────────────────┐
 │ S3: Agent       │───────┤                                ├─────▶│ S8: Director    │───┐
 │ Registry        │       │      ┌─────────────────┐       │      │ Agent           │   │
 └─────────────────┘       │      │ S7: Context     │       │      └─────────────────┘   │
                           ├─────▶│ Management      │───────┤                            │
 ┌─────────────────┐       │      │ System          │       │      ┌─────────────────┐   │   ┌─────────────────┐
 │ S4: Message     │───────┤      └─────────────────┘       ├─────▶│ S9: Specialist  │   ├──▶│ S11: CLI        │
 │ Bus             │       │                                │      │ Agent           │   │   │ Entry Points    │
 └─────────────────┘       │      ┌─────────────────┐       │      └─────────────────┘   │   └─────────────────┘
                           │      │ S10: Claude SDK │       │                            │
 ┌─────────────────┐       │      │ Integration     │───────┘                            │   ┌─────────────────┐
 │ S5: Checkpoint  │───────┴─────▶│                 │                                    └──▶│ Demo Script     │
 │ System          │              └─────────────────┘                                        │ + Polish        │
 └─────────────────┘                                                                         └─────────────────┘



╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                       AGENT MAIL FLOW                                                 ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

                              ┌─────────────────────────────────┐
                              │         DIRECTOR AGENT          │
                              │                                 │
                              │  Context Window:                │
                              │  ┌───────────────────────────┐  │
                              │  │ [MAIL] From: researcher   │  │◀─────────────────┐
                              │  │ Type: result | ID: msg-42 │  │                  │
                              │  │ Preview: "Found 3 sources"│  │    Notification  │
                              │  └───────────────────────────┘  │    (lightweight) │
                              │                                 │                  │
                              │  > Calls readMessage("msg-42")  │                  │
                              │                                 │                  │
                              └─────────────────┬───────────────┘                  │
                                                │                                  │
                                                │ Tool call                        │
                                                ▼                                  │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         MONGODB                                                      │
│                                                                                                      │
│  messages collection:                                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                                            │    │
│  │   messageId: "msg-42",                                                                       │    │
│  │   fromAgent: "researcher-001",                                                               │────┼────┐
│  │   toAgent: "director-001",                                                                   │    │    │
│  │   content: "Found 3 sources on MongoDB agent patterns:\n1. Official docs...\n2. ...",       │    │    │
│  │   type: "result",                                                                            │    │    │
│  │   threadId: "thread-7",                                                                      │    │    │
│  │   readAt: null  ──────────────────────────────▶  readAt: "2026-01-10T10:30:00Z"             │    │    │
│  │ }                                                                                            │    │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘    │    │
│                                                                                                      │    │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
                                                │                                                           │
                                                │ Full content                                              │
                                                ▼                                                           │
                              ┌─────────────────────────────────┐                                           │
                              │         DIRECTOR AGENT          │                                           │
                              │                                 │                                           │
                              │  Now has full message:          │                                           │
                              │  "Found 3 sources on MongoDB    │                                           │
                              │   agent patterns:               │                                           │
                              │   1. Official docs...           │                                           │
                              │   2. ..."                       │                                           │
                              │                                 │                                           │
                              │  > Processes and coordinates    │                                           │
                              │  > Sends task to Writer         │                                           │
                              │                                 │                                           │
                              └─────────────────┬───────────────┘                                           │
                                                │                                                           │
                                                │ sendMessage()                                             │
                                                ▼                                                           │
                              ┌─────────────────────────────────┐                                           │
                              │         WRITER AGENT            │                                           │
                              │                                 │                                           │
                              │  Context Window:                │                                           │
                              │  ┌───────────────────────────┐  │                                           │
                              │  │ [MAIL] From: director     │  │◀──────────────────────────────────────────┘
                              │  │ Type: task | ID: msg-43   │  │
                              │  │ Preview: "Write summary.."│  │
                              │  └───────────────────────────┘  │
                              │                                 │
                              └─────────────────────────────────┘



╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                     CHECKPOINT & RESUME FLOW                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝


    AGENT RUNNING                           INTERRUPT                           RESUME
    ═════════════                           ═════════                           ══════

┌─────────────────────┐                ┌─────────────────┐              ┌─────────────────────┐
│  Specialist Agent   │                │                 │              │  Specialist Agent   │
│                     │                │    Ctrl+C       │              │  (Restarted)        │
│  Working on task... │                │    Crash        │              │                     │
│  ────────────────   │                │    Network      │              │  > Loading checkpoint│
│  Phase: RESEARCH    │───────────────▶│                 │─────────────▶│  > Resuming session │
│  Progress: 60%      │                │                 │              │  > Continuing...    │
│                     │                │                 │              │                     │
└─────────┬───────────┘                └─────────────────┘              └──────────┬──────────┘
          │                                                                        │
          │ Periodic checkpoint                                                    │ Load checkpoint
          ▼                                                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           MONGODB                                                    │
│                                                                                                      │
│  checkpoints collection:                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                                            │    │
│  │   checkpointId: "chk-99",                                                                    │    │
│  │   agentId: "specialist-researcher-001",                                                      │    │
│  │   summary: {                                                                                 │    │
│  │     goal: "Research MongoDB agent coordination patterns",                                    │    │
│  │     completed: ["Found official docs", "Found 2 blog posts"],                               │    │
│  │     pending: ["Search GitHub examples", "Synthesize findings"],                             │    │
│  │     decisions: ["Using Atlas Vector Search for RAG"]                                        │    │
│  │   },                                                                                         │    │
│  │   resumePointer: {                                                                           │    │
│  │     nextAction: "Search GitHub for mongodb agent examples",                                 │    │
│  │     phase: "RESEARCH",                                                                       │    │
│  │     currentContext: "Looking at coordination patterns"                                      │    │
│  │   },                                                                                         │    │
│  │   tokensUsed: 45000,                                                                         │    │
│  │   createdAt: "2026-01-10T10:25:00Z"                                                         │    │
│  │ }                                                                                            │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                      │
│  agents collection:                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                                            │    │
│  │   agentId: "specialist-researcher-001",                                                      │    │
│  │   sessionId: "sdk-session-abc123",  ◀──── Used for SDK resume                               │    │
│  │   status: "working" ──▶ "error" ──▶ "working",                                              │    │
│  │   ...                                                                                        │    │
│  │ }                                                                                            │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘


    RESUME SEQUENCE:
    ════════════════

    1. Load agent record → Get sessionId
                              │
                              ▼
    2. Load latest checkpoint → Get summary + resumePointer
                              │
                              ▼
    3. Build context packet:
       ┌─────────────────────────────────────────────────────────┐
       │  ## Resuming from Checkpoint                            │
       │                                                         │
       │  **Goal:** Research MongoDB agent coordination patterns │
       │                                                         │
       │  **Completed:**                                         │
       │  - Found official docs                                  │
       │  - Found 2 blog posts                                   │
       │                                                         │
       │  **Pending:**                                           │
       │  - Search GitHub examples                               │
       │  - Synthesize findings                                  │
       │                                                         │
       │  **Next Action:** Search GitHub for mongodb agent...    │
       │  **Phase:** RESEARCH                                    │
       └─────────────────────────────────────────────────────────┘
                              │
                              ▼
    4. Call SDK with: query({ prompt: contextPacket, options: { resume: sessionId } })
                              │
                              ▼
    5. Agent continues from exactly where it left off ✓



╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                         DEMO VISUALIZATION                                            ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        DEMO SETUP                                                    │
│                                                                                                      │
│  ┌──────────────────────────────────────────┐  ┌──────────────────────────────────────────────────┐ │
│  │            TERMINAL (60%)                 │  │           MONGODB COMPASS (40%)                  │ │
│  │                                           │  │                                                  │ │
│  │  ┌─────────────────────────────────────┐  │  │  ┌──────────────────────────────────────────┐   │ │
│  │  │ $ pnpm run director                 │  │  │  │ squad-lite.agents                        │   │ │
│  │  │                                     │  │  │  │ ──────────────────────────────────────── │   │ │
│  │  │ [Director] Starting...              │  │  │  │ ▶ director-001     status: working       │   │ │
│  │  │ [Director] Received task:           │  │  │  │ ▶ researcher-001   status: working       │   │ │
│  │  │   "Research and write report on..." │  │  │  │ ▶ writer-001       status: idle          │   │ │
│  │  │ [Director] Decomposing...           │  │  │  └──────────────────────────────────────────┘   │ │
│  │  │ [Director] Spawning Researcher      │  │  │                                                  │ │
│  │  │ [Director] Spawning Writer          │  │  │  ┌──────────────────────────────────────────┐   │ │
│  │  └─────────────────────────────────────┘  │  │  │ squad-lite.messages (Live)               │   │ │
│  │                                           │  │  │ ──────────────────────────────────────── │   │ │
│  │  ┌─────────────────────────────────────┐  │  │  │ ● D→R: "Research MongoDB patterns..."   │   │ │
│  │  │ $ pnpm run specialist --type=...    │  │  │  │ ● R→D: "Found 3 sources..."             │   │ │
│  │  │                                     │  │  │  │ ● D→W: "Write summary using..."         │   │ │
│  │  │ [Researcher] Starting...            │  │  │  │ ● W→D: "Draft complete"                 │   │ │
│  │  │ [Researcher] Got task from Director │  │  │  └──────────────────────────────────────────┘   │ │
│  │  │ [Researcher] Searching web...       │  │  │                                                  │ │
│  │  │ [Researcher] Found 3 sources        │  │  │  ┌──────────────────────────────────────────┐   │ │
│  │  │ [Researcher] Checkpointing...       │  │  │  │ squad-lite.checkpoints                   │   │ │
│  │  │ ^C                                  │  │  │  │ ──────────────────────────────────────── │   │ │
│  │  │                                     │  │  │  │ ▶ researcher: phase=RESEARCH (60%)      │   │ │
│  │  │ [Killed]                            │  │  │  │   nextAction: "Synthesize findings"     │   │ │
│  │  └─────────────────────────────────────┘  │  │  └──────────────────────────────────────────┘   │ │
│  │                                           │  │                                                  │ │
│  │  ┌─────────────────────────────────────┐  │  │                                                  │ │
│  │  │ $ pnpm run specialist --resume      │  │  │        ┌────────────────────────┐               │ │
│  │  │                                     │  │  │        │   "Look! Checkpoint    │               │ │
│  │  │ [Researcher] Loading checkpoint...  │  │  │        │    exists. Now watch   │               │ │
│  │  │ [Researcher] Resuming from RESEARCH │  │  │        │    it resume..."       │               │ │
│  │  │ [Researcher] Continuing: Synthesize │  │  │        └────────────────────────┘               │ │
│  │  │ [Researcher] Done! Sending results  │  │  │                                                  │ │
│  │  └─────────────────────────────────────┘  │  │                                                  │ │
│  │                                           │  │                                                  │ │
│  └───────────────────────────────────────────┘  └──────────────────────────────────────────────────┘ │
│                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                         TIMELINE (3 MIN)                                              ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

0:00                    0:30                    1:00                    1:30                    2:00                    2:30                    3:00
  │                       │                       │                       │                       │                       │                       │
  ▼                       ▼                       ▼                       ▼                       ▼                       ▼                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│░░░░░░░░░░░░░░░░░░░│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│████████████████████│▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│░░░░░░░░░░░░░░░░░░░│
│   Start Director   │  Spawn Agents     │   KILL AGENT        │   Show Checkpoint  │   RESUME AGENT     │  Wrap Up            │
│   Show task        │  Show messages    │   (The WOW moment)  │   in MongoDB       │   Show continuation│  Recap thesis       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

Legend: ░░░ Setup   ▓▓▓ Coordination   ███ Kill Demo   ▒▒▒ Checkpoint Show   ░░░ Recap

